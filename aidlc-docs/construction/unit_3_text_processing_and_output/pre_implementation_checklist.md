# Unit 3 実装開始前の確認事項

Unit 3（テキスト処理・出力）の実装を開始するにあたり、事前に決定が必要な項目をまとめます。

---

## 1. Gemini Flash API

### 1-1. API の呼び出し方法

Gemini Flash API の呼び出しには以下の選択肢があります。

| 方式 | メリット | デメリット |
|---|---|---|
| **A. REST API 直接呼び出し** | 依存なし。URLSession のみで実装可能 | JSON のパース・エラーハンドリングを手動実装 |
| **B. Google AI Swift SDK** | 型安全。公式サポート | SPM 依存追加が必要 |

[Question] A（REST 直接）/ B（SDK）のどちらで進めますか？
[Answer]
Bでお願いします。


### 1-2. API キーの管理

Gemini Flash API には API キーが必要です。

| 方式 | 説明 |
|---|---|
| **直接埋め込み** | ソースコードにハードコード（⚠️ セキュリティ上非推奨） |
| **環境変数** | `GEMINI_API_KEY` 環境変数から読み取り |
| **設定画面で入力** | SettingsView に入力欄を設けてユーザーに入力させる |
| **Keychain** | macOS Keychain に安全に保存 |

[Question] API キーの管理方法はどれにしますか？初回実装時はどの程度のセキュリティが必要ですか？
[Answer]
Keychainでお願いします。


### 1-3. リライト用プロンプト

Gemini Flash に対して送信するプロンプトの方針を確認します。

```
以下の音声認識結果を自然な日本語/英語に修正してください:
- フィラーワード（えーと、あのー、um、uh）を除去
- 文法を修正
- 句読点を適切に挿入
- 元の意味は保持
```

[Question] 上記のようなプロンプトで問題ありませんか？カスタマイズの必要はありますか？
[Answer]
問題ありません。

---

## 2. テキスト出力

### 2-1. アクティブフィールドへの直接入力

macOS でアクティブなテキストフィールドにテキストを挿入する方法には以下があります。

| 方式 | メリット | デメリット |
|---|---|---|
| **A. CGEvent（キーイベントシミュレーション）** | 多くのアプリで動作。Command+V ペースト方式 | アクセシビリティ権限が必要 |
| **B. Accessibility API（AX API 直接操作）** | テキストフィールドに直接値を設定 | アプリのサポート状況に依存 |
| **C. NSPasteboard + CGEvent（クリップボード経由ペースト）** | 最も確実・広い互換性 | ユーザーのクリップボード内容を上書きする |

[Question] どの方式で進めますか？方式 C（クリップボード経由ペースト）が最も互換性が高いですが、ユーザーのクリップボードを一時的に上書きしてしまいます。これは許容範囲ですか？
[Answer]
Cでお願いします。

### 2-2. アクセシビリティ権限

テキスト挿入には**アクセシビリティ権限**が必要です（システム設定 > プライバシーとセキュリティ > アクセシビリティ）。

[Question] アプリ起動時にアクセシビリティ権限のリクエストダイアログを表示する方針で問題ありませんか？
[Answer]
問題ありません。

---

## 回答状況

| # | 項目 | 回答状況 |
|---|---|---|
| 1-1 | API 呼び出し方法 | ⬜ 未回答 |
| 1-2 | API キー管理 | ⬜ 未回答 |
| 1-3 | リライトプロンプト | ⬜ 未回答 |
| 2-1 | アクティブフィールドへの入力方式 | ⬜ 未回答 |
| 2-2 | アクセシビリティ権限 | ⬜ 未回答 |
